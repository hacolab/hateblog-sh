# Getting Started Guide
hatenablog-shを使いはじめるためのチュートリアルだよ.

- [ブログの登録](#ブログの登録)
- [使用するコマンドの設定(全ブログ共通設定)](#使用するコマンドの設定全ブログ共通設定)
- [はじめての記事作成](#はじめての記事作成)
- [投稿済み記事の編集](#投稿済み記事の編集)
- [サーバの最新状態の記事を取得](#サーバの最新状態の記事を取得)
- [記事の削除](#記事の削除)

## ブログの登録
インストールが終わったら、まずはきみのブログを登録しよう.  
下のコマンドを打つと、はてなブログID の入力を求められる.  
きみの はてなブログID を入力してね.  
例では`myblog.hatenablog.com`を入力しているよ.  

```
$ hblg config new       # ブログの登録(hblg cnでも同じ)
New BlogID > myblog.hatenablog.com
```

入力を確定したら、設定ファイルの編集だ.  
勝手に下のような設定ファイルをエディタで開くと思う.(#から始まるのはコメント行)  
きみの はてなID と AtomPubのAPIキー を入力しよう.  

はてなID は、はてなブログにログインするときのIDだよ.  
AtomPubのAPIキー は、[はてなブログの詳細設定ページ](http://blog.hatena.ne.jp/my/config/detail)で確認できるよ.

各設定項目の説明は[こちら](README.md#各ブログ用の設定ファイル)を見てね.  

```
# Your Blog ID : exp) blog-name.hatena.com
BLOG_ID=myblog.hatenablog.com
# Your hatena ID
HATENA_ID=
# Your hatena blog api key
API_KEY=
# Auto backup enable(ON|OFF)
AUTO_BACKUP=OFF
```

設定が終わったら、保存してエディタを閉じよう.  
閉じると下のようにデフォルトのブログに設定するか確認されるよ.

実はこのスクリプトは無駄に複数のブログを登録できるようになっているんだ.  
ブログの指定は`-b`オプションでできるけど、指定しないときはデフォルトに設定したブログに対して操作を行うよ.  
最初のブログなので必ず`y`を入力してEnterキーを押してね.

```
'myblog.hatenablog.com' set to default blog?(y/n)> y
```

設定が正しくできているか、下のコマンドで確認しよう.  
コマンドの実行終了までちょっと時間がかかるかもしれない.  
もし何もメッセージが出ずに終了したら正しく設定できていると思うよ.  

```
$ hblg fetch             # 記事リストの取得・作成 (hblg f)
```

もし何かメッセージが出たとしたら、HTTPリクエストとレスポンスのメッセージじゃないかな？  
下の表のエラーメッセージの原因と対策を確認してみてね.  

|エラーメッセージ            |考えられる原因           |対策
|:---------------------------|:------------------------|:-----------------------------
|< HTTP/1.1 401 Unauthorized |はてなIDやAPIキーの誤り  |`hblg ce`で設定見直し
|< HTTP/1.1 403 Forbidden    |ブログIDの誤り           |`hblg cn`で新しくブログを登録<br>`hblg cd`で誤ったブログ設定を削除

その他のHTTPレスポンスについては[こちら](http://developer.hatena.ne.jp/ja/documents/blog/apis/atom#p6)を参考にしてね.

## 使用するコマンドの設定(全ブログ共通設定)
このスクリプトで使うツールを、きみが使いやすいものに変えておこう.  
下のコマンドを打つと、設定ファイルを開くよ.

```
$ hblg config common    # 共通設定の編集(hblg ccでも同じ)
```

設定ファイルは下みたいな感じ. (#から始まるのはコメント行)
各設定項目の説明は[こちら](README.md#共通の設定ファイル)を見てね.  

```
# Use default BlogID (auto set this value)
DEFAULT_BLOG_ID=myblog.hatenablog.com
# Use editor (if null use '\$EDITOR' or vi)
EDITOR=
# Diff viewer (when not equal post response vs local file)
DIFF_VIEWER=diff -u
# File selector (Use command 'draft edit', 'config edit', etc...)
FILE_SELECTOR=fzf --select-1 --no-sort --preview='head -n 60 {}'
# Not File list selector (Use 'edit')
LINE_SELECTOR=fzf --select-1 --no-sort
```

記事の編集や差分確認に使う、EDITORとDIFF_VIEWERは変えておくと幸せかもしれない.  
nvimを使いたい場合は下みたいな感じ.  

```
EDITOR=nvim
DIFF_VIEWER=nvim -d
```

もし`fzf`ではなくて他の選択ツールを使いたい場合は、FILE_SELECTOR, LINE_SELECTORを変更しよう.  
[peco](https://github.com/peco/peco)を使いたい場合は下みたいな感じ.  
今のところ複数選択には対応していないので注意してね.  

```
FILE_SELECTOR=peco --select-1
LINE_SELECTOR=peco --select-1
```

設定が終わったら、保存してエディタを閉じよう.

## はじめての記事作成
それでは新しい記事を作成してみよう.  
まずは下のコマンドを実行してみてね.  

```
$ hblg new              # 記事の新規作成(hblg nでも同じ)
```

すると勝手にエディタが開いて新しい記事の編集状態になると思う. 
(テンプレートが複数ある場合は、テンプレート選択画面が出るよ)

デフォルトの記事のテンプレートフォーマットは下みたいな感じ.  

```


yes
(exp cate1,cate2...)
#Title

[:contents]
```

空行の1〜2行目と、3行目は投稿に必要な情報が入る場所.  
新規作成時はそのままにしておいてね.  
4行目は記事のカテゴリをカンマ区切りで入力しよう.  
5行目が記事のタイトル、6行目以降は記事本文になるよ.  
本文はMarkdown形式で記載してね.  

サンプル記事は下みたいな感じ.

```


yes
カテゴリだよ,diary
#これはタイトルだよ
これ以降は本文だよ.

はてなブログを操作するシェルスクリプトを書いたよ.

詳細は[こちら](https://github.com/hacolab/hateblog-sh)を見てね.


```

記事を編集し終わったら、保存してエディタを閉じよう.  

すると下のような確認が出てくるので、`y`か`n`で答えてね.  
ちなみに投稿しなかった未投稿記事は、`hblg draft edit (またはhblg de)`で編集できるよ.

```
Upload now?(y/n)> y     # y: 今すく投稿        n: 投稿しない
Draft?(y/n)> y          # y: 下書きとして投稿  n: 公開記事として投稿
```

投稿後は、投稿した記事とはてなブログのサーバに実際に保存された記事の差分が出るので確認しておこう.  
差分が出るとしたら、気にしなくていい最初の2行とタイトルの先頭末尾の空白削除くらいじゃないかな.  
(それ以外はバグの可能性が高いかも)

下のようにローカルのファイルをサーバから取得したファイルで上書くか確認される.
`y`か`n`で答えてね.  

```
Update local file(by response contents)?(y/n)> y
# y: サーバへ保存したファイルでローカルファイルを上書き
# n: ローカルファイルの状態はそのまま保持(差分確認で不都合があったとき用. hblg editで再編集してね)
```

以上で、記事の新規作成から投稿までは終わりだよ.

## 投稿済み記事の編集
つぎに、投稿済みの記事を編集してみよう.  
下のコマンドを打つと記事一覧が表示されるので、好きな記事を選ぼう.  

```
$ hblg edit             # 投稿済み記事の編集(hblg eでも同じ)
```

記事を選ぶと選んだ記事のファイルが勝手に開くよ.

あとは基本的には新しい記事の作成と同じだけど、エディタを閉じた後に、
投稿済みの記事と投稿しようとしている記事の差分が表示されるよ.  
(差分がない場合は、変更されてない旨のメッセージが出るだけ)

差分に問題がなければ、(差分ビューワを閉じて)下の確認に答えてね.

```
Upload now?(y/n)> y     # y: 今すく投稿        n: 投稿しない
Draft?(y/n)> y          # y: 下書きとして投稿  n: 公開記事として投稿
```

ちなみに一度公開した記事は、下書きには戻せないんだ.  
スクリプトが悪いのか、はてなブログのAPIの仕様なのかは知らないけど、  
ひとまず今は、下書きに戻したい時はブラウザから操作しないといけない.  
ごめんよ.


## サーバの最新状態の記事を取得
もし、ブラウザやスマホアプリから投稿済みの記事を編集したら、  
ローカルの記事ファイルに反映させたいと思う.

そんなときは、下のコマンドを打てばいいよ.  
記事リストと一緒に、サーバで修正された記事がダウンロードされるよ.

```
$ hblg fetch            # サーバの最新記事の取得 (hblg fでも同じ)
```

注意点として、ローカルの記事ファイルを修正してアップロードしてなかった場合、  
その修正は消えちゃう(サーバの最新状態で上書きされちゃう)から気をつけてね.


## 記事の削除
記事を削除の仕方を説明するよ.
下のコマンドを打つと、記事選択画面が出るので削除したい記事を選んでね.

```
$ hblg entry delete     # 投稿済み記事の削除 (hblg d)
$ hblg draft delete     # 未投稿記事の削除   (hblg dd)
```

記事を選んだ後は、記事本文の先頭が表示され、削除するか確認されるよ.

```
Do you want to delete this entry?(y/n)> y
# y: 削除する   n: 削除しない
```

注意点として、削除した記事はスクリプトでは復元できないよ.

復元したい場合は、削除後30日以内に[こちらのページ](http://blog.hatena.ne.jp/my/trash)から操作してね.

そして復元後は「見たままモード」になるのがはてなブログの仕様なので、  
Markdown形式に戻すのは手間かもしれない.

記事の削除は慎重にね.


## さいごに
おつかれさま.

以上でチュートリアルは終わりだよ.

これで日常的に使う操作はできるようになったはずだよ.

他のコマンドやファイルフォーマットなどの詳細については[Usage](README.md#Usage)を見てね.


